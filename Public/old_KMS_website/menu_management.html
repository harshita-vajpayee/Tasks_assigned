<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Add Chosen CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.min.css">
    <!-- Add Bootstrap Datepicker CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <style>
        thead, tr, th{
            background-color: rgb(239, 218, 186);
        };
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-primary shadow">
        <div class="container-fluid d-flex justify-content-between">
            <div class="d-flex justify-content-center align-items-center my-0 py-0">
                <button class="btn text-white" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBothOptions"
                    aria-controls="offcanvasWithBothOptions">
                    <span class="navbar-toggler-icon text-white"></span>
                </button>
                <a class=" navbar-brand text-white text-uppercase" href="#">Kitchen</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div class=" d-flex justify-content-end">
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0 z-100">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle text-white" href="#" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">Menu</a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">Action</a></li>
                                <li><a class="dropdown-item" href="#">Another action</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="#">Something else here</a></li>
                            </ul>
                        </li>
                    </ul>
                    <img class="object-fit-cover border rounded-circle " style="width: 40px;" src="/images/profile.jpg"
                        alt="profile">
                </div>
            </div>
        </div>
    </nav>

    <!--  Sidebar -->
    <div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions"
        aria-labelledby="offcanvasWithBothOptionsLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasWithBothOptionsLabel">Backdrop with scrolling</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div class="list-group list-group-flush mx-2 mt-4">
                <a href="/home.html" class="listOfLinks list-group-item list-group-item-action py-2 ripple" aria-current="true">
                    <i class="fas fa-tachometer-alt fa-fw me-3"></i><span>ICS Home</span>
                </a>
                <a href="/menu_management.html" class="active listOfLinks list-group-item list-group-item-action py-2 ripple">
                    <i class="fas fa-chart-area fa-fw me-3"></i><span>Menu Management</span>
                </a>
                <a href="/all_meal_count.html" class="listOfLinks list-group-item list-group-item-action py-2 ripple">
                    <i class="fas fa-lock fa-fw me-3"></i><span>All Meals Count</span>
                </a>
                <a href="/all_cooking_sheets.html"
                    class="listOfLinks list-group-item list-group-item-action py-2 ripple">
                    <i class="fas fa-chart-line fa-fw me-3"></i><span>All Cooking Sheets</span>
                </a>
                <a href="/" class="listOfLinks list-group-item list-group-item-action py-2 ripple">
                    <i class="fas fa-chart-pie fa-fw me-3"></i><span>Serving Data Entry</span>
                </a>
                <a href="/purchase_list.html" class="listOfLinks list-group-item list-group-item-action py-2 ripple">
                    <i class="fas fa-chart-bar fa-fw me-3"></i><span>Purchase List</span>
                </a>
                <a href="/" class="listOfLinks list-group-item list-group-item-action py-2 ripple">
                    <i class="fas fa-globe fa-fw me-3"></i><span>All Recipes</span>
                </a>
                <a href="/calendar.html" class="listOfLinks list-group-item list-group-item-action py-2 ripple">
                    <i class="fas fa-building fa-fw me-3"></i><span>Event Calendar</span>
                </a>
                <a href="/costCalculator.html" class="listOfLinks list-group-item list-group-item-action py-2 ripple">
                    <i class="fas fa-calendar fa-fw me-3"></i><span>Cost Calculator</span>
                </a>
                <a href="#" class="listOfLinks list-group-item list-group-item-action py-2 ripple">
                    <i class="fas fa-users fa-fw me-3"></i><span>About</span>
                </a>
                <a href="#" class="listOfLinks list-group-item list-group-item-action py-2 ripple">
                    <i class="fas fa-logout fa-fw me-3"></i><span>Logout</span>
                </a>

            </div>
        </div>
    </div>

    <div>
        <h3 class="text-center text-white bg-success p-2">Hare Krishna</h3>

        <div class="row g-4 g-lg-4 mx-2">
            <div class="form-group col">
                <label for="datepicker">Select Date To Add:</label>
                <input type="text" id="datepicker" class="form-control" placeholder="Select a date">
                <button id="addButton" class="btn text-white mt-2" style="background-color: #00bcd4;">Add A Date</button>
            </div>
            <div class="col-6">
                <h1 style="min-height: 160px; background-color: #00bcd4;" class="col text-white text-center p-4">Department: NVCC Kitchen</h1>
            </div>
            <div class="col d-flex justify-content-end">
                <div>
                    <button class="btn btn-success" onclick="window.print()">Print</button>
                    <button id="rearrange" class="btn text-white" style="background-color: #00bcd4;">Rearrange</button>
                    <button id="default-items" class="btn btn-danger">Default Items</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-xxl mx-2">


        <!-- Table to display data -->
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th style=" background-color: rgb(239, 218, 186);">Week</th>
                    <th style=" background-color: rgb(239, 218, 186);">Date</th>
                    <th style=" background-color: rgb(239, 218, 186);">Events</th>
                    <th style=" background-color: rgb(239, 218, 186);">Breakfast</th>
                    <th style=" background-color: rgb(239, 218, 186);">Lunch</th>
                    <th style=" background-color: rgb(239, 218, 186);">Dinner</th>
                    <th style=" background-color: rgb(239, 218, 186);">CM</th>
                    <th style=" background-color: rgb(239, 218, 186);">MC</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <tr style="background-color: aliceblue;">
                    <td>30</td>
                    <td>2023-07-25</td>
                    <td contenteditable="true"></td>
                    <td>
                        <select class="form-control chosen-select" data-row="new" data-meal="breakfast" multiple>
                            <option value="Cereal">Cereal</option>
                            <option value="Omelette">Omelette</option>
                            <option value="Pancakes">Pancakes</option>
                        </select>
                    </td>
                    <td>
                        <select class="form-control chosen-select" data-row="new" data-meal="lunch" multiple>
                            <option value="Sandwich">Sandwich</option>
                            <option value="Salad">Salad</option>
                            <option value="Pasta">Pasta</option>
                        </select>
                    </td>
                    <td>
                        <select class="form-control chosen-select" data-row="new" data-meal="dinner" multiple>
                            <option value="Pizza">Pizza</option>
                            <option value="Steak">Steak</option>
                            <option value="Sushi">Sushi</option>
                        </select>
                    </td>
                    <td contenteditable="true"></td>
                    <td></td>
                </tr>
                <!-- Rows will be dynamically added here -->
            </tbody>
        </table>
    </div>

    <!-- Add Bootstrap JS and jQuery (required for Datepicker) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Add Chosen JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.jquery.min.js"></script>
    <!-- Add Bootstrap Datepicker JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

    <script>
        $(document).ready(function () {
            // Initialize the Datepicker
            $('#datepicker').datepicker({
                format: 'yyyy-mm-dd',
                autoclose: true,
            });

            // Event listener for the "Add Item" button
            $('#addButton').click(function () {
                var selectedDate = $('#datepicker').val();
                if (selectedDate.trim() === '') {
                    alert('Please select a valid date.');
                    return;
                }

                // Check if the date already exists in the table
                var existingDates = Array.from(document.querySelectorAll('#tableBody td:nth-child(2)')).map(function (cell) {
                    return cell.textContent;
                });
                if (existingDates.includes(selectedDate)) {
                    alert('Date already exists in the table.');
                    return;
                }

                // Add a new row with the selected date
                var newRow = `
                    <tr style="background-color: aliceblue;">
                        <td>New</td>
                        <td>${selectedDate}</td>
                        <td contenteditable="true"></td>
                        <td>
                            <select class="form-control chosen-select" data-row="new" data-meal="breakfast" multiple>
                                <option value="Cereal">Cereal</option>
                                <option value="Omelette">Omelette</option>
                                <option value="Pancakes">Pancakes</option>
                            </select>
                        </td>
                        <td>
                            <select class="form-control chosen-select" data-row="new" data-meal="lunch" multiple>
                                <option value="Sandwich">Sandwich</option>
                                <option value="Salad">Salad</option>
                                <option value="Pasta">Pasta</option>
                            </select>
                        </td>
                        <td>
                            <select class="form-control chosen-select" data-row="new" data-meal="dinner" multiple>
                                <option value="Pizza">Pizza</option>
                                <option value="Steak">Steak</option>
                                <option value="Sushi">Sushi</option>
                            </select>
                        </td>
                        <td contenteditable="true"></td>
                        <td></td>
                    </tr>
                `;
                $('#tableBody').append(newRow);
                // Initialize Chosen for the newly added row
                $('.chosen-select').chosen();
                // Update the table rows based on date order
                updateTableOrder();
            });

            // Event listener for "Add More" buttons
            $(document).on('click', '.add-more-food', function () {
                var rowNumber = $(this).data('row');
                var mealType = $(this).data('meal');
                var newRow = `
                    <select class="form-control chosen-select" data-row="${rowNumber}" data-meal="${mealType}" multiple>
                        <option value="New Food 1">New Food 1</option>
                        <option value="New Food 2">New Food 2</option>
                        <option value="New Food 3">New Food 3</option>
                    </select>
                `;
                $(this).before(newRow);
                // Initialize Chosen for the newly added dropdown
                $('.chosen-select').chosen();
            });

            // Event listener for "input" event on editable "Event" and "CM" cells
            $(document).on('input', '#tableBody td[contenteditable="true"]', function () {
                // Get the row and column index of the edited cell
                var row = $(this).closest('tr').index();
                var col = $(this).index();

                // Update the data array with the edited value
                data[row][col] = $(this).text().trim();
            });

            // Function to update the table rows based on date order
            function updateTableOrder() {
                var rows = Array.from(document.querySelectorAll('#tableBody tr'));
                rows.sort(function (a, b) {
                    var dateA = new Date($(a).find('td:eq(1)').text());
                    var dateB = new Date($(b).find('td:eq(1)').text());
                    return dateA - dateB;
                });

                var weekNumber = 1;
                rows.forEach(function (row, index) {
                    // Update the week number for each row
                    var date = new Date($(row).find('td:eq(1)').text());
                    var newWeekNumber = getWeekNumber(date);

                    if (newWeekNumber !== weekNumber) {
                        weekNumber = newWeekNumber;
                    }

                    $(row).find('td:eq(0)').text(weekNumber);
                });
            }

            // Custom function to get the week number of a date based on ISO 8601 standard
            function getWeekNumber(date) {
                var firstDayOfYear = new Date(date.getFullYear(), 0, 1);
                var daysOffset = date.getDay() > 0 ? date.getDay() - 1 : 6;
                var firstMonday = new Date(date.getFullYear(), 0, 1 + daysOffset);
                var weekNumber = Math.floor((date - firstMonday) / 604800000) + 1; // 604800000 = 7 * 24 * 60 * 60 * 1000 (milliseconds in a week)
                return weekNumber;
            }

            // Initialize Chosen for the existing select elements
            $('.chosen-select').chosen();
        });
    </script>
</body>

</html>